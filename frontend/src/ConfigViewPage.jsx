// // src/frontend/ConfigViewPage.jsx
// import React, { useEffect, useState } from "react";
// import { useParams } from "react-router-dom";

// function ConfigViewPage() {
//     const { mech, index } = useParams();
//     const [config, setConfig] = useState(null);

//     useEffect(() => {
//         fetch(`/api/get-config?mech=${mech}&index=${index}`)
//             .then((res) => res.json())
//             .then((data) => setConfig(data.content))
//             .catch(() => setConfig("‚ö†Ô∏è Ëé∑ÂèñÈÖçÁΩÆÂ§±Ë¥•"));
//     }, [mech, index]);

//     const handleDownload = () => {
//         const blob = new Blob([config], { type: 'text/xml' });
//         const link = document.createElement('a');
//         link.href = URL.createObjectURL(blob);
//         link.download = `${mech}_config_${index}.xml`;
//         link.click();
//     };

//     return (
//         <div style={{ padding: "30px", backgroundColor: "#111", color: "#fff", minHeight: "100vh" }}>
//             <h2>üìÑ {mech.toUpperCase()} Config (Index {index})</h2>
//             <button onClick={handleDownload} style={{
//                 padding: "10px", marginBottom: "20px", backgroundColor: "#555", color: "#fff", border: "none", borderRadius: "4px"
//             }}>
//                 ‚¨áÔ∏è Download XML
//             </button>
//             <pre style={{
//                 backgroundColor: "#222", padding: "20px", borderRadius: "8px",
//                 border: "1px solid #444", whiteSpace: "pre-wrap", overflowX: "auto"
//             }}>
//                 {config || "Loading..."}
//             </pre>
//         </div>
//     );
// }

// export default ConfigViewPage;


// import React from 'react';
// import { useLocation } from 'react-router-dom';

// function ConfigViewPage() {
//   const location = useLocation();
//   const queryParams = new URLSearchParams(location.search);

//   const uri = queryParams.get("uri");
//   const configEncoded = queryParams.get("config");
//   const actualConnectDetailsStr = queryParams.get("details");//8.13

//   let decodedConfig = "";
//   try {
//     decodedConfig = decodeURIComponent(atob(configEncoded));
//   } catch (error) {
//     decodedConfig = "‚ö†Ô∏è Error decoding configuration content.";
//   }
//   // 8.13
//   let connectDetails = [];
//   try {
//       const detailsJson = atob(actualConnectDetailsStr || "");
//       connectDetails = JSON.parse(detailsJson);
//   } catch (err) {
//       console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê actualConnectDetails:", err);
//   } 
//   const renderConnectDetailTable = () => {
//       if (!Array.isArray(connectDetails) || connectDetails.length === 0) return null;

//       return (
//           <div style={{ marginTop: "2rem" }}>
//               <h3>üîå Actual Connection Test Results</h3>
//               <table style={{ width: "100%", borderCollapse: "collapse", color: "#eee" }}>
//                   <thead>
//                       <tr style={{ backgroundColor: "#2c3e50" }}>
//                           <th>Protocol</th>
//                           <th>Host</th>
//                           <th>Port</th>
//                           <th>Plain</th>
//                           <th>STARTTLS</th>
//                           <th>TLS</th>
//                       </tr>
//                   </thead>
//                   <tbody>
//                       {connectDetails.map((item, idx) => (
//                           <tr key={idx} style={{ backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e" }}>
//                               <td>{item.type}</td>
//                               <td>{item.host}</td>
//                               <td>{item.port}</td>
//                               <td>{renderConnectionInfo(item.plain)}</td>
//                               <td>{renderConnectionInfo(item.starttls)}</td>
//                               <td>{renderConnectionInfo(item.tls)}</td>
//                           </tr>
//                       ))}
//                   </tbody>
//               </table>
//           </div>
//       );
//   };

//   const renderConnectionInfo = (info) => {
//       if (!info || !info.success) return <span style={{ color: "red" }}>‚ùå</span>;
//       return (
//           <div style={{ fontSize: "0.9em" }}>
//               ‚úÖ <br />
//               TLS: {info.info?.version || "?"} <br />
//               Cipher: {info.info?.cipher?.join(', ') || "N/A"}
//           </div>
//       );
//   };


//   return (
//     <div style={{ backgroundColor: "#111", minHeight: "100vh", padding: "2rem", color: "#fff" }}>
//       <h2>üìÑ Configuration from Method</h2>
//       <p><strong>Requested URI:</strong> {uri}</p>

//       <pre style={{
//         background: "#1e1e1e",
//         color: "#eee",
//         padding: "20px",
//         borderRadius: "8px",
//         whiteSpace: "pre-wrap",
//         maxHeight: "80vh",
//         overflowY: "auto",
//         border: "1px solid #444"
//       }}>
//         {decodedConfig}
//       </pre>

//       <a
//         href={`data:text/plain;charset=utf-8,${encodeURIComponent(decodedConfig)}`}
//         download={`config_from_${encodeURIComponent(uri || 'unknown')}.xml`}
//         style={{
//           display: "inline-block",
//           marginTop: "1rem",
//           backgroundColor: "#3498db",
//           color: "#fff",
//           padding: "10px 15px",
//           textDecoration: "none",
//           borderRadius: "4px"
//         }}
//       >
//         ‚¨áÔ∏è Download Configuration
//       </a>

//       {renderConnectDetailTable()}
//     </div>
//   );
// }

// export default ConfigViewPage;


// import React, { useEffect, useState } from 'react';
// import { useLocation } from 'react-router-dom';
// import { PeculiarCertificateViewer } from '@peculiar/certificates-viewer-react';

// function ConfigViewPage() {
//   const location = useLocation();
//   const queryParams = new URLSearchParams(location.search);

//   const uri = queryParams.get("uri");
//   const configEncoded = queryParams.get("config");
//   const tempId = queryParams.get("id"); // ‚úÖ Êñ∞Â¢ûÔºåÁî®‰∫é GUESS / ‰∏¥Êó∂Â≠òÂÇ®

//   const [connectDetails, setConnectDetails] = useState([]);
//   const [rawCerts, setRawCerts] = useState([]);
//   const [showCertChain, setShowCertChain] = useState(false);
//   const [activeCertIdx, setActiveCertIdx] = useState(0);


//   let decodedConfig = "";
//   try {
//     decodedConfig = decodeURIComponent(atob(configEncoded || ""));
//   } catch (error) {
//     decodedConfig = "‚ö†Ô∏è Error decoding configuration content.";
//   }

//   // useEffect(() => {
//   //   if (tempId) {
//   //     fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//   //       .then(res => res.json())
//   //       .then(data => {
//   //         setConnectDetails(data.details || []);
//   //         setRawCerts(data.rawCerts || []);
//   //       })
//   //       .catch(err => console.error("‚ùå Failed to fetch temp data:", err));
//   //   }else{
//   //       if ((uri === "guess_results" || uri === "srv_results") && tempId) {
//   //       fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//   //         .then(res => res.json())
//   //         .then(data => setConnectDetails(data))
//   //         .catch(err => console.error("‚ùå Failed to fetch temp data:", err));
//   //       } else if (uri !== "guess_results") {
//   //         // Â¶ÇÊûú‰∏çÊòØ‰∏¥Êó∂Â≠òÂÇ®ÊñπÂºèÔºåÂ∞ùËØï‰ªé details URL ÂèÇÊï∞Ëß£Êûê
//   //         const actualConnectDetailsStr = queryParams.get("details");
//   //         if (actualConnectDetailsStr) {
//   //           try {
//   //             const detailsJson = atob(actualConnectDetailsStr);
//   //             setConnectDetails(JSON.parse(detailsJson));
//   //           } catch (err) {
//   //             console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê actualConnectDetails:", err);
//   //           }
//   //         }
//   //       }
//   //       const rawCertsEncoded = queryParams.get("rawCerts");
//   //       if (rawCertsEncoded) {
//   //         try {
//   //           const certs = JSON.parse(atob(rawCertsEncoded));
//   //           if (Array.isArray(certs)) {
//   //             setRawCerts(certs);
//   //           }
//   //         } catch (err) {
//   //           console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê rawCerts:", err);
//   //         }
//   //       }
//   //     }
//   // //   if ((uri === "guess_results" || uri === "srv_results") && tempId) {
//   // //     fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//   // //       .then(res => res.json())
//   // //       .then(data => setConnectDetails(data))
//   // //       .catch(err => console.error("‚ùå Failed to fetch temp data:", err));
//   // //   } else if (uri !== "guess_results") {
//   // //     // Â¶ÇÊûú‰∏çÊòØ‰∏¥Êó∂Â≠òÂÇ®ÊñπÂºèÔºåÂ∞ùËØï‰ªé details URL ÂèÇÊï∞Ëß£Êûê
//   // //     const actualConnectDetailsStr = queryParams.get("details");
//   // //     if (actualConnectDetailsStr) {
//   // //       try {
//   // //         const detailsJson = atob(actualConnectDetailsStr);
//   // //         setConnectDetails(JSON.parse(detailsJson));
//   // //       } catch (err) {
//   // //         console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê actualConnectDetails:", err);
//   // //       }
//   // //     }
//   // //   }
//   // //   const rawCertsEncoded = queryParams.get("rawCerts");
//   // //   if (rawCertsEncoded) {
//   // //     try {
//   // //       const certs = JSON.parse(atob(rawCertsEncoded));
//   // //       if (Array.isArray(certs)) {
//   // //         setRawCerts(certs);
//   // //       }
//   // //     } catch (err) {
//   // //       console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê rawCerts:", err);
//   // //     }
//   // //   }
//   // // }, [uri, tempId, queryParams]);
//   //   }, [tempId]);
//   useEffect(() => {
//     if (tempId) {
//       // Êúâ‰∏¥Êó∂ IDÔºåÁõ¥Êé•‰ªéÂêéÁ´ØËé∑Âèñ
//       fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//         .then(res => res.json())
//         .then(data => {
//           setConnectDetails(data.score_detail?.actualconnect_details || []);
//           setRawCerts(data.rawCerts || []);
//         })
//         .catch(err => console.error("‚ùå Failed to fetch temp data:", err));
//     } else {
//       // Ê≤°Êúâ‰∏¥Êó∂ IDÔºå‰ªé URL Ëß£ÊûêÔºàÂè™ÈÄÇÂêàÂ∞èÊï∞ÊçÆÔºâ
//       const detailsEncoded = queryParams.get("details");
//       if (detailsEncoded) {
//         try {
//           const detailsJson = atob(detailsEncoded);
//           setConnectDetails(JSON.parse(detailsJson));
//         } catch (err) {
//           console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê details:", err);
//         }
//       }

//       const rawCertsEncoded = queryParams.get("rawCerts");
//       if (rawCertsEncoded) {
//         try {
//           const certs = JSON.parse(atob(rawCertsEncoded));
//           if (Array.isArray(certs)) {
//             setRawCerts(certs);
//           }
//         } catch (err) {
//           console.warn("‚ö†Ô∏è Êó†Ê≥ïËß£Êûê rawCerts:", err);
//         }
//       }
//     }
//   }, [tempId, queryParams]);


//   const renderConnectionInfo = (info) => {
//     if (!info || !info.success) return <span style={{ color: "red" }}>‚ùå</span>;
//     return (
//       <div style={{ fontSize: "0.9em" }}>
//         ‚úÖ <br />
//         TLS: {info.info?.version || "?"} <br />
//         Cipher: {info.info?.cipher?.join(', ') || "N/A"}
//       </div>
//     );
//   };

//   const renderConnectDetailTable = () => {
//     if (!Array.isArray(connectDetails) || connectDetails.length === 0) return null;

//     return (
//       <div style={{ marginTop: "2rem" }}>
//         <h3>üîå Actual Connection Test Results</h3>
//         <table style={{ width: "100%", borderCollapse: "collapse", color: "#eee" }}>
//           <thead>
//             <tr style={{ backgroundColor: "#2c3e50" }}>
//               <th>Protocol</th>
//               <th>Host</th>
//               <th>Port</th>
//               <th>Plain</th>
//               <th>STARTTLS</th>
//               <th>TLS</th>
//             </tr>
//           </thead>
//           <tbody>
//             {connectDetails.map((item, idx) => (
//               <tr key={idx} style={{ backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e" }}>
//                 <td>{item.type}</td>
//                 <td>{item.host}</td>
//                 <td>{item.port}</td>
//                 <td>{renderConnectionInfo(item.plain)}</td>
//                 <td>{renderConnectionInfo(item.starttls)}</td>
//                 <td>{renderConnectionInfo(item.tls)}</td>
//               </tr>
//             ))}
//           </tbody>
//         </table>
//       </div>
//     );
//   };

//   const renderCertChain = () => {
//     if (!Array.isArray(rawCerts) || rawCerts.length === 0) return null;

//     return (
//         <div style={{ marginTop: "2rem" }}>
//             <h3
//                 onClick={() => setShowCertChain(prev => !prev)}
//                 style={{ cursor: "pointer", color: "#8ac6ff", userSelect: "none" }}
//             >
//                 üîê Certificate Chain {showCertChain ? "‚ñ≤" : "‚ñº"}
//             </h3>

//             {showCertChain && (
//                 <>
//                     <div style={{ marginBottom: '10px' }}>
//                         {rawCerts.map((_, idx) => (
//                             <button
//                                 key={idx}
//                                 onClick={() => setActiveCertIdx(idx)}
//                                 style={{
//                                     marginRight: '8px',
//                                     padding: '4px 10px',
//                                     backgroundColor: activeCertIdx === idx ? '#007bff' : '#ddd',
//                                     color: activeCertIdx === idx ? '#fff' : '#000',
//                                     border: 'none',
//                                     borderRadius: '4px',
//                                     cursor: 'pointer'
//                                 }}
//                             >
//                                 #{idx + 1}
//                             </button>
//                         ))}
//                     </div>
//                     <PeculiarCertificateViewer certificate={rawCerts[activeCertIdx]} />
//                 </>
//             )}
//         </div>
//     );
//   };


//   return (
//     <div style={{ backgroundColor: "#111", minHeight: "100vh", padding: "2rem", color: "#fff" }}>
//       <h2>üìÑ Configuration from Method</h2>
//       <p><strong>Requested URI:</strong> {uri}</p>

//       <pre style={{
//         background: "#1e1e1e",
//         color: "#eee",
//         padding: "20px",
//         borderRadius: "8px",
//         whiteSpace: "pre-wrap",
//         maxHeight: "80vh",
//         overflowY: "auto",
//         border: "1px solid #444"
//       }}>
//         {decodedConfig}
//       </pre>

//       <a
//         href={`data:text/plain;charset=utf-8,${encodeURIComponent(decodedConfig)}`}
//         download={`config_from_${encodeURIComponent(uri || 'unknown')}.xml`}
//         style={{
//           display: "inline-block",
//           marginTop: "1rem",
//           backgroundColor: "#3498db",
//           color: "#fff",
//           padding: "10px 15px",
//           textDecoration: "none",
//           borderRadius: "4px"
//         }}
//       >
//         ‚¨áÔ∏è Download Configuration
//       </a>

//       {renderConnectDetailTable()}
//       {renderCertChain()}
//     </div>
//   );
// }

// export default ConfigViewPage;


// import React, { useEffect, useState } from "react";
// import { useLocation } from "react-router-dom";
// import { PeculiarCertificateViewer } from '@peculiar/certificates-viewer-react';

// function ConfigViewPage() {
//   const location = useLocation();
//   const queryParams = new URLSearchParams(location.search);
//   const tempId = queryParams.get("id"); // ÂâçÁ´ØÂè™‰ºö‰º† id

//   const [uri, setUri] = useState("");
//   const [configContent, setConfigContent] = useState("‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÈÖçÁΩÆ");
//   const [connectDetails, setConnectDetails] = useState([]);
//   const [rawCerts, setRawCerts] = useState([]);
//   const [showCertChain, setShowCertChain] = useState(false);
//   const [activeCertIdx, setActiveCertIdx] = useState(0);

//   // ÂàùÂßãÂåñÔºö‰ªéÂêéÁ´ØÊãâÊï∞ÊçÆ
//   useEffect(() => {
//     if (!tempId) return;

//     fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//       .then(res => res.json())
//       .then(data => {
//         console.log("‚úÖ ÊãâÂèñËØ¶ÊÉÖÊï∞ÊçÆ:", data);
//         setUri(data.uri || "");
//         setConfigContent(data.config || "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÖçÁΩÆÂÜÖÂÆπ");
//         setConnectDetails(data.details || []);
//         setRawCerts(data.rawCerts || []);
//       })
//       .catch(err => {
//         console.error("‚ùå Failed to fetch temp data:", err);
//         setConfigContent("‚ö†Ô∏è Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•");
//       });
//   }, [tempId]);

//   const renderConnectionInfo = (info) => {
//     if (!info || !info.success) return <span style={{ color: "red" }}>‚ùå</span>;
//     return (
//       <div style={{ fontSize: "0.9em" }}>
//         ‚úÖ <br />
//         TLS: {info.info?.version || "?"} <br />
//         Cipher: {info.info?.cipher?.join(", ") || "N/A"}
//       </div>
//     );
//   };

//   const renderConnectDetailTable = () => {
//     if (!Array.isArray(connectDetails) || connectDetails.length === 0) return null;

//     return (
//       <div style={{ marginTop: "2rem" }}>
//         <h3>üîå Actual Connection Test Results</h3>
//         <table style={{ width: "100%", borderCollapse: "collapse", color: "#eee" }}>
//           <thead>
//             <tr style={{ backgroundColor: "#2c3e50" }}>
//               <th>Protocol</th>
//               <th>Host</th>
//               <th>Port</th>
//               <th>Plain</th>
//               <th>STARTTLS</th>
//               <th>TLS</th>
//             </tr>
//           </thead>
//           <tbody>
//             {connectDetails.map((item, idx) => (
//               <tr
//                 key={idx}
//                 style={{ backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e" }}
//               >
//                 <td>{item.type}</td>
//                 {/* <td>{item.host}</td> */}
//                 <td>
//                   {item.host}
//                   <button
//                     style={{ marginLeft: "8px", padding: "2px 6px" }}
//                     onClick={() => handleRetest(item)}
//                   >
//                     Retest
//                   </button>
//                 </td>

//                 <td>{item.port}</td>
//                 <td>{renderConnectionInfo(item.plain)}</td>
//                 <td>{renderConnectionInfo(item.starttls)}</td>
//                 <td>{renderConnectionInfo(item.tls)}</td>
//               </tr>
//             ))}
//           </tbody>
//         </table>
//       </div>
//     );
//   };

//   const renderCertChain = () => {
//     if (!Array.isArray(rawCerts) || rawCerts.length === 0) return null;

//     return (
//       <div style={{ marginTop: "2rem" }}>
//         <h3
//           onClick={() => setShowCertChain((prev) => !prev)}
//           style={{ cursor: "pointer", color: "#8ac6ff", userSelect: "none" }}
//         >
//           üîê Certificate Chain {showCertChain ? "‚ñ≤" : "‚ñº"}
//         </h3>

//         {showCertChain && (
//           <>
//             <div style={{ marginBottom: "10px" }}>
//               {rawCerts.map((_, idx) => (
//                 <button
//                   key={idx}
//                   onClick={() => setActiveCertIdx(idx)}
//                   style={{
//                     marginRight: "8px",
//                     padding: "4px 10px",
//                     backgroundColor: activeCertIdx === idx ? "#007bff" : "#ddd",
//                     color: activeCertIdx === idx ? "#fff" : "#000",
//                     border: "none",
//                     borderRadius: "4px",
//                     cursor: "pointer",
//                   }}
//                 >
//                   #{idx + 1}
//                 </button>
//               ))}
//             </div>
//             <PeculiarCertificateViewer certificate={rawCerts[activeCertIdx]} />
//           </>
//         )}
//       </div>
//     );
//   };

//   return (
//     <div
//       style={{
//         backgroundColor: "#111",
//         minHeight: "100vh",
//         padding: "2rem",
//         color: "#fff",
//       }}
//     >
//       <h2>üìÑ Configuration from Method</h2>
//       <p>
//         <strong>Requested URI:</strong> {uri}
//       </p>

//       <pre
//         style={{
//           background: "#1e1e1e",
//           color: "#eee",
//           padding: "20px",
//           borderRadius: "8px",
//           whiteSpace: "pre-wrap",
//           maxHeight: "80vh",
//           overflowY: "auto",
//           border: "1px solid #444",
//         }}
//       >
//         {configContent}
//       </pre>

//       <a
//         href={`data:text/plain;charset=utf-8,${encodeURIComponent(configContent)}`}
//         download={`config_from_${encodeURIComponent(uri || "unknown")}.xml`}
//         style={{
//           display: "inline-block",
//           marginTop: "1rem",
//           backgroundColor: "#3498db",
//           color: "#fff",
//           padding: "10px 15px",
//           textDecoration: "none",
//           borderRadius: "4px",
//         }}
//       >
//         ‚¨áÔ∏è Download Configuration
//       </a>

//       {renderConnectDetailTable()}
//       {renderCertChain()}
//     </div>
//   );
// }

// export default ConfigViewPage;


// import { useEffect, useState } from "react";
// import { useLocation } from "react-router-dom";
// import { PeculiarCertificateViewer } from '@peculiar/certificates-viewer-react';

// function ConfigViewPage() {
//   const location = useLocation();
//   const queryParams = new URLSearchParams(location.search);
//   const tempId = queryParams.get("id"); // ÂâçÁ´ØÂè™‰ºö‰º† id

//   const [uri, setUri] = useState("");
//   const [configContent, setConfigContent] = useState("‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÈÖçÁΩÆ");
//   const [connectDetails, setConnectDetails] = useState([]);
//   const [rawCerts, setRawCerts] = useState([]);
//   const [showCertChain, setShowCertChain] = useState(false);
//   const [activeCertIdx, setActiveCertIdx] = useState(0);

//   // üîå Êñ∞Â¢ûÁöÑÁä∂ÊÄÅÔºöÂÆûÊó∂ÊµãËØï
//   const [liveLogs, setLiveLogs] = useState([]);
//   const [liveResult, setLiveResult] = useState(null);
//   const [testingHost, setTestingHost] = useState(null);

//   // ÂàùÂßãÂåñÔºö‰ªéÂêéÁ´ØÊãâÊï∞ÊçÆ
//   useEffect(() => {
//     if (!tempId) return;

//     fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
//       .then((res) => res.json())
//       .then((data) => {
//         console.log("‚úÖ ÊãâÂèñËØ¶ÊÉÖÊï∞ÊçÆ:", data);
//         setUri(data.uri || "");
//         setConfigContent(data.config || "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÖçÁΩÆÂÜÖÂÆπ");
//         setConnectDetails(data.details || []);
//         setRawCerts(data.rawCerts || []);
//       })
//       .catch((err) => {
//         console.error("‚ùå Failed to fetch temp data:", err);
//         setConfigContent("‚ö†Ô∏è Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•");
//       });
//   }, [tempId]);

//   // Â§çÊµãÈÄªËæëÔºàWebSocketÔºâ
//   const handleRetest = (item) => {
//     const { host, port, type } = item;

//     const protocol = window.location.protocol === "https:" ? "wss" : "ws";
//     const wsUrl = `${protocol}://${window.location.host}/ws/testconnect?host=${host}&port=${port}&protocol=${type}`;
//     console.log("üîå Retest connecting:", wsUrl);

//     const ws = new WebSocket(wsUrl);

//     setLiveLogs([]);
//     setLiveResult(null);
//     setTestingHost(`${type}://${host}:${port}`);

//     ws.onopen = () => {
//       setLiveLogs((prev) => [...prev, "üîó WebSocket Â∑≤ËøûÊé•"]);
//     };

//     ws.onmessage = (event) => {
//       try {
//         const data = JSON.parse(event.data);
//         if (data.Host) {
//           setLiveResult(data);
//           setLiveLogs((prev) => [...prev, "‚úÖ ÊµãËØïÁªìÊûúÂ∑≤ËøîÂõû"]);
//           ws.close();
//         } else if (data.type === "log") {
//           setLiveLogs((prev) => [...prev, data.content]);
//         } else {
//           setLiveLogs((prev) => [...prev, event.data]);
//         }
//       } catch {
//         setLiveLogs((prev) => [...prev, event.data]);
//       }
//     };

//     ws.onerror = (e) => {
//       console.error("‚ùå WebSocket error", e);
//       setLiveLogs((prev) => [...prev, "‚ùå WebSocket error"]);
//       ws.close();
//     };

//     ws.onclose = () => {
//       setLiveLogs((prev) => [...prev, "üîö ÊµãËØïÂ∑≤ÁªìÊùü"]);
//     };
//   };

//   const renderConnectionInfo = (info) => {
//     if (!info || !info.success)
//       return <span style={{ color: "red" }}>‚ùå</span>;
//     return (
//       <div style={{ fontSize: "0.9em" }}>
//         ‚úÖ <br />
//         TLS: {info.info?.version || "?"} <br />
//         Cipher: {info.info?.cipher?.join(", ") || "N/A"}
//       </div>
//     );
//   };

//   const renderConnectDetailTable = () => {
//     if (!Array.isArray(connectDetails) || connectDetails.length === 0)
//       return null;

//     return (
//       <div style={{ marginTop: "2rem" }}>
//         <h3>üîå Actual Connection Test Results</h3>
//         <table
//           style={{
//             width: "100%",
//             borderCollapse: "collapse",
//             color: "#eee",
//           }}
//         >
//           <thead>
//             <tr style={{ backgroundColor: "#2c3e50" }}>
//               <th>Protocol</th>
//               <th>Host</th>
//               <th>Port</th>
//               <th>Plain</th>
//               <th>STARTTLS</th>
//               <th>TLS</th>
//             </tr>
//           </thead>
//           <tbody>
//             {connectDetails.map((item, idx) => (
//               <tr
//                 key={idx}
//                 style={{
//                   backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e",
//                 }}
//               >
//                 <td>{item.type}</td>
//                 <td>
//                   {item.host}
//                   <button
//                     style={{
//                       marginLeft: "8px",
//                       padding: "2px 6px",
//                       cursor: "pointer",
//                     }}
//                     onClick={() => handleRetest(item)}
//                   >
//                     Retest
//                   </button>
//                 </td>
//                 <td>{item.port}</td>
//                 <td>{renderConnectionInfo(item.plain)}</td>
//                 <td>{renderConnectionInfo(item.starttls)}</td>
//                 <td>{renderConnectionInfo(item.tls)}</td>
//               </tr>
//             ))}
//           </tbody>
//         </table>

//         {testingHost && (
//           <div
//             style={{
//               marginTop: "2rem",
//               padding: "1rem",
//               backgroundColor: "#222",
//             }}
//           >
//             <h4>üîç Testing: {testingHost}</h4>
//             <div
//               style={{
//                 maxHeight: "200px",
//                 overflowY: "auto",
//                 background: "#111",
//                 padding: "1rem",
//                 fontFamily: "monospace",
//                 fontSize: "14px",
//               }}
//             >
//               {liveLogs.map((line, idx) => (
//                 <div key={idx}>{line}</div>
//               ))}
//             </div>

//             {liveResult && (
//               <div
//                 style={{
//                   marginTop: "1rem",
//                   padding: "1rem",
//                   backgroundColor: "#333",
//                   border: "1px solid #666",
//                 }}
//               >
//                 <h4>‚úÖ Final Result</h4>
//                 <pre
//                   style={{ whiteSpace: "pre-wrap", color: "#eee" }}
//                 >
//                   {JSON.stringify(liveResult, null, 2)}
//                 </pre>
//               </div>
//             )}
//           </div>
//         )}
//       </div>
//     );
//   };

//   const renderCertChain = () => {
//     if (!Array.isArray(rawCerts) || rawCerts.length === 0) return null;

//     return (
//       <div style={{ marginTop: "2rem" }}>
//         <h3
//           onClick={() => setShowCertChain((prev) => !prev)}
//           style={{ cursor: "pointer", color: "#8ac6ff", userSelect: "none" }}
//         >
//           üîê Certificate Chain {showCertChain ? "‚ñ≤" : "‚ñº"}
//         </h3>

//         {showCertChain && (
//           <>
//             <div style={{ marginBottom: "10px" }}>
//               {rawCerts.map((_, idx) => (
//                 <button
//                   key={idx}
//                   onClick={() => setActiveCertIdx(idx)}
//                   style={{
//                     marginRight: "8px",
//                     padding: "4px 10px",
//                     backgroundColor:
//                       activeCertIdx === idx ? "#007bff" : "#ddd",
//                     color: activeCertIdx === idx ? "#fff" : "#000",
//                     border: "none",
//                     borderRadius: "4px",
//                     cursor: "pointer",
//                   }}
//                 >
//                   #{idx + 1}
//                 </button>
//               ))}
//             </div>
//             <PeculiarCertificateViewer
//               certificate={rawCerts[activeCertIdx]}
//             />
//           </>
//         )}
//       </div>
//     );
//   };

//   return (
//     <div
//       style={{
//         backgroundColor: "#111",
//         minHeight: "100vh",
//         padding: "2rem",
//         color: "#fff",
//       }}
//     >
//       <h2>üìÑ Configuration from Method</h2>
//       <p>
//         <strong>Requested URI:</strong> {uri}
//       </p>

//       <pre
//         style={{
//           background: "#1e1e1e",
//           color: "#eee",
//           padding: "20px",
//           borderRadius: "8px",
//           whiteSpace: "pre-wrap",
//           maxHeight: "80vh",
//           overflowY: "auto",
//           border: "1px solid #444",
//         }}
//       >
//         {configContent}
//       </pre>

//       <a
//         href={`data:text/plain;charset=utf-8,${encodeURIComponent(
//           configContent
//         )}`}
//         download={`config_from_${encodeURIComponent(uri || "unknown")}.xml`}
//         style={{
//           display: "inline-block",
//           marginTop: "1rem",
//           backgroundColor: "#3498db",
//           color: "#fff",
//           padding: "10px 15px",
//           textDecoration: "none",
//           borderRadius: "4px",
//         }}
//       >
//         ‚¨áÔ∏è Download Configuration
//       </a>

//       {renderConnectDetailTable()}
//       {renderCertChain()}
//     </div>
//   );
// }

// export default ConfigViewPage;


import { useEffect, useState } from "react";
import { useLocation } from "react-router-dom";
import { PeculiarCertificateViewer } from '@peculiar/certificates-viewer-react';

function ConfigViewPage() {
  const location = useLocation();
  const queryParams = new URLSearchParams(location.search);
  const tempId = queryParams.get("id");

  const [uri, setUri] = useState("");
  const [configContent, setConfigContent] = useState("‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÈÖçÁΩÆ");
  const [connectDetails, setConnectDetails] = useState([]);
  const [rawCerts, setRawCerts] = useState([]);
  const [showCertChain, setShowCertChain] = useState(false);
  const [activeCertIdx, setActiveCertIdx] = useState(0);

  // üëá Êñ∞Â¢û state
  const [liveLogs, setLiveLogs] = useState([]);
  const [liveResult, setLiveResult] = useState(null);
  const [testingHost, setTestingHost] = useState(null);

  const [mech, setMech] = useState("");

  const [showTlsCert, setShowTlsCert] = useState(false);
  const [selectedMode, setSelectedMode] = useState("ssl");
  const [rowModes, setRowModes] = useState({});



  useEffect(() => {
    if (!tempId) return;

    fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
      .then(res => res.json())
      .then(data => {
        console.log("‚úÖ ÊãâÂèñËØ¶ÊÉÖÊï∞ÊçÆ:", data);
        setUri(data.uri || "");
        setConfigContent(data.config || "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÖçÁΩÆÂÜÖÂÆπ");
        setConnectDetails(data.details || []);
        setRawCerts(data.rawCerts || []);
        setMech(data.mech || ""); // ‚úÖ ‰øùÂ≠ò mech
      })
      .catch(err => {
        console.error("‚ùå Failed to fetch temp data:", err);
        setConfigContent("‚ö†Ô∏è Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•");
      });
  }, [tempId]);


  // // ÂàùÂßãÂåñÔºö‰ªéÂêéÁ´ØÊãâÊï∞ÊçÆ
  // useEffect(() => {
  //   if (!tempId) return;

  //   fetch(`http://localhost:8081/get-temp-data?id=${tempId}`)
  //     .then(res => res.json())
  //     .then(data => {
  //       console.log("‚úÖ ÊãâÂèñËØ¶ÊÉÖÊï∞ÊçÆ:", data);
  //       setUri(data.uri || "");
  //       setConfigContent(data.config || "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÖçÁΩÆÂÜÖÂÆπ");
  //       setConnectDetails(data.details || []);
  //       setRawCerts(data.rawCerts || []);
  //     })
  //     .catch(err => {
  //       console.error("‚ùå Failed to fetch temp data:", err);
  //       setConfigContent("‚ö†Ô∏è Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•");
  //     });
  // }, [tempId]);

  // üëá Â§çÁî®ÊóßÈÄªËæëÔºöÁÇπÂáª Retest Ëµ∞ WebSocket
  const handleRetest = (item, mode) => {
    const { host, port, type } = item;
  // setTestingHost(item.host);
    setLiveLogs([]);
    setLiveResult(null);
    setTestingHost(`${type}://${host}:${port} [${type}, ${mode}]`); 

    const ws = new WebSocket(
      `ws://localhost:8081/ws/testconnect?host=${item.host}&port=${item.port}&protocol=${item.type}&mode=${mode}`
    );

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === "log") {
        setLiveLogs((prev) => [...prev, data.content]);
      } else if (data.type === "result") {
        setLiveResult(data.result);
      }
    };
  };

  // const handleRetest = (item) => {
  //   const { host, port, type } = item;

  //   const ws = new WebSocket(
  //     `${window.location.protocol === "https:" ? "wss" : "ws"}://localhost:8081/ws/testconnect?host=${host}&port=${port}&protocol=${type}`
  //   );


  //   setLiveLogs([]);
  //   setLiveResult(null);
  //   setTestingHost(`${type}://${host}:${port}`);

  //   ws.onmessage = (event) => {
  //     const msg = JSON.parse(event.data);
  //     if (msg.type === "log") {
  //       setLiveLogs((prev) => [...prev, msg.content]);
  //     } else if (msg.type === "result") {
  //       setLiveResult(msg.result);
  //       ws.close();
  //     }
  //   };

  //   ws.onerror = () => {
  //     setLiveLogs((prev) => [...prev, "‚ùå Connection error."]);
  //     ws.close();
  //   };
  // };

  const renderConnectionInfo = (info) => {
    if (!info || !info.success) return <span style={{ color: "red" }}>‚ùå</span>;
    return (
      <div style={{ fontSize: "0.9em" }}>
        ‚úÖ <br />
        TLS: {info.info?.version || "?"} <br />
        Cipher: {info.info?.cipher?.join(", ") || "N/A"}
      </div>
    );
  };

  // const renderConnectDetailTable = () => {
  //   if (!Array.isArray(connectDetails) || connectDetails.length === 0) return null;

  //   return (
  //     <div style={{ marginTop: "2rem" }}>
  //       <h3>üîå Actual Connection Test Results</h3>
  //       <table style={{ width: "100%", borderCollapse: "collapse", color: "#eee" }}>
  //         <thead>
  //           <tr style={{ backgroundColor: "#2c3e50" }}>
  //             <th>Protocol</th>
  //             <th>Host</th>
  //             <th>Port</th>
  //             <th>Plain</th>
  //             <th>STARTTLS</th>
  //             <th>TLS</th>
  //           </tr>
  //         </thead>
  //         <tbody>
  //           {connectDetails.map((item, idx) => (
  //             <tr
  //               key={idx}
  //               style={{ backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e" }}
  //             >
  //               <td>{item.type}</td>
  //               <td>
  //                 {item.host}
  //                 <button
  //                   style={{ marginLeft: "8px", padding: "2px 6px" }}
  //                   onClick={() => handleRetest(item, selectedMode)}
  //                 >
  //                   Retest
  //                 </button>
  //                 <select
  //                   style={{ marginLeft: "8px" }}
  //                   onChange={(e) => setSelectedMode(e.target.value)}
  //                 >
  //                   <option value="plain">Plain</option>
  //                   <option value="starttls">STARTTLS</option>
  //                   <option value="ssl">SSL/TLS</option>
  //                 </select>
  //               </td>

  //               {/* <td>
  //                 {item.host}
  //                 <button
  //                   style={{ marginLeft: "8px", padding: "2px 6px" }}
  //                   onClick={() => handleRetest(item)}
  //                 >
  //                   Retest
  //                 </button>
  //               </td> */}
  //               <td>{item.port}</td>
  //               <td>{renderConnectionInfo(item.plain)}</td>
  //               <td>{renderConnectionInfo(item.starttls)}</td>
  //               <td>{renderConnectionInfo(item.tls)}</td>
  //             </tr>
  //           ))}
  //         </tbody>
  //       </table>

  //       {/* üëá Retest ÁöÑÊó•ÂøóÂ±ïÁ§∫ */}
  //       {testingHost && (
  //         <div style={{ marginTop: "2rem", padding: "1rem", backgroundColor: "#222" }}>
  //           <h4>üîç Testing: {testingHost}</h4>
  //           <div
  //             style={{
  //               maxHeight: "200px",
  //               overflowY: "auto",
  //               background: "#111",
  //               padding: "1rem",
  //               fontFamily: "monospace",
  //               fontSize: "14px",
  //             }}
  //           >
  //             {liveLogs.map((line, idx) => (
  //               <div key={idx}>{line}</div>
  //             ))}
  //           </div>
            
  //           {liveResult && (
  //             <div
  //               style={{
  //                 marginTop: "1rem",
  //                 padding: "1rem",
  //                 backgroundColor: "#333",
  //                 border: "1px solid #666",
  //               }}
  //             >
  //               <h4>‚úÖ Final Result</h4>
  //               {liveResult.success ? (
  //                 <>
  //                   <p>‚úÖ ÊµãËØïÊàêÂäü</p>
  //                   <p><strong>TLS ÁâàÊú¨Ôºö</strong>{liveResult.info?.version || "Êú™Áü•"}</p>
  //                   <p><strong>Âä†ÂØÜÂ•ó‰ª∂Ôºö</strong>{liveResult.info?.cipher?.join(", ") || "N/A"}</p>

  //                   {liveResult.info?.["tls ca"] && (
  //                     <>
  //                       <div style={{ marginTop: "1rem" }}>
  //                         <h4
  //                           onClick={() => setShowTlsCert((prev) => !prev)}
  //                           style={{
  //                             cursor: "pointer",
  //                             color: "#e7ecf2ff",
  //                             userSelect: "none",
  //                           }}
  //                         >
  //                           üîê Êü•ÁúãÊúçÂä°Âô®ËØÅ‰π¶‰ø°ÊÅØ {showTlsCert ? "‚ñ≤" : "‚ñº"}
  //                         </h4>
  //                         {showTlsCert && (
  //                           <PeculiarCertificateViewer certificate={liveResult.info["tls ca"]} />
  //                         )}
  //                       </div>
  //                       <a
  //                         href={`data:text/plain;charset=utf-8,${encodeURIComponent(liveResult.info["tls ca"])}`}
  //                         download={`certificate_${testingHost}.crt`}
  //                         style={{
  //                           display: "inline-block",
  //                           marginTop: "1rem",
  //                           backgroundColor: "#5bc889ff",
  //                           color: "#fff",
  //                           padding: "8px 12px",
  //                           textDecoration: "none",
  //                           borderRadius: "4px",
  //                         }}
  //                       >
  //                         ‚¨áÔ∏è ‰∏ãËΩΩÊúçÂä°Âô®ËØÅ‰π¶
  //                       </a>
  //                     </>
  //                   )}
  //                 </>
  //               ) : (
  //                 <>
  //                   <p style={{ color: "red" }}>‚ùå ÊµãËØïÂ§±Ë¥•</p>
  //                   <p><strong>ÈîôËØØ‰ø°ÊÅØÔºö</strong>{liveResult.error}</p>
  //                 </>
  //               )}
  //             </div>
  //           )}


  //           {/* {liveResult && (
  //             <div
  //               style={{
  //                 marginTop: "1rem",
  //                 padding: "1rem",
  //                 backgroundColor: "#333",
  //                 border: "1px solid #666",
  //               }}
  //             >
  //               <h4>‚úÖ Final Result</h4>
  //               <pre style={{ whiteSpace: "pre-wrap", color: "#eee" }}>
  //                 {JSON.stringify(liveResult, null, 2)}
  //               </pre>
  //             </div>
  //           )} */}
  //         </div>
  //       )}
  //     </div>
  //   );
  // };
  const renderConnectDetailTable = () => {
    if (!Array.isArray(connectDetails) || connectDetails.length === 0) return null;

    // // ÊØèË°åÁã¨Á´ãÊ®°Âºè
    // const [rowModes, setRowModes] = useState({}); // key: idx, value: mode

    return (
      <div style={{ marginTop: "2rem" }}>
        <h3>üîå Actual Connection Test Results</h3>
        <table style={{ width: "100%", borderCollapse: "collapse", color: "#eee" }}>
          <thead>
            <tr style={{ backgroundColor: "#2c3e50" }}>
              <th>Protocol</th>
              <th>Host</th>
              <th>Port</th>
              <th>Plain</th>
              <th>STARTTLS</th>
              <th>TLS</th>
            </tr>
          </thead>
          <tbody>
            {connectDetails.map((item, idx) => (
              <tr
                key={idx}
                style={{ backgroundColor: idx % 2 === 0 ? "#34495e" : "#3d566e" }}
              >
                <td>{item.type}</td>
                <td>
                  {item.host}
                  {/* ‰∏ãÊãâÂú®ÂâçÔºåÊåâÈíÆÂú®Âêé */}
                  <select
                    style={{ marginLeft: "8px" }}
                    value={rowModes[idx] || "plain"}
                    onChange={(e) =>
                      setRowModes((prev) => ({ ...prev, [idx]: e.target.value }))
                    }
                  >
                    <option value="plain">Plain</option>
                    <option value="starttls">STARTTLS</option>
                    <option value="ssl">SSL/TLS</option>
                  </select>
                  <button
                    style={{ marginLeft: "8px", padding: "2px 6px" }}
                    onClick={() => handleRetest(item, rowModes[idx] || "plain")}
                  >
                    Retest
                  </button>
                </td>
                <td>{item.port}</td>
                <td>{renderConnectionInfo(item.plain)}</td>
                <td>{renderConnectionInfo(item.starttls)}</td>
                <td>{renderConnectionInfo(item.tls)}</td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* üëá Retest ÁöÑÊó•ÂøóÂ±ïÁ§∫ */}
        {testingHost && (
          <div style={{ marginTop: "2rem", padding: "1rem", backgroundColor: "#222" }}>
            <h4>
              üîç Testing: {testingHost}
              {/* {testingPort && `:${testingPort}`} [{testingProtocol}, {testingMode}] */}
            </h4>
            <div
              style={{
                maxHeight: "200px",
                overflowY: "auto",
                background: "#111",
                padding: "1rem",
                fontFamily: "monospace",
                fontSize: "14px",
              }}
            >
              {liveLogs.map((line, idx) => (
                <div key={idx}>{line}</div>
              ))}
            </div>

            {liveResult && (
              <div
                style={{
                  marginTop: "1rem",
                  padding: "1rem",
                  backgroundColor: "#333",
                  border: "1px solid #666",
                }}
              >
                <h4>‚úÖ Final Result</h4>
                {liveResult.success ? (
                  <>
                    <p>‚úÖ ÊµãËØïÊàêÂäü</p>
                    <p><strong>TLS ÁâàÊú¨Ôºö</strong>{liveResult.info?.version || "Êú™Áü•"}</p>
                    <p><strong>Âä†ÂØÜÂ•ó‰ª∂Ôºö</strong>{liveResult.info?.cipher?.join(", ") || "N/A"}</p>

                    {liveResult.info?.["tls ca"] && (
                      <>
                        <div style={{ marginTop: "1rem" }}>
                          <h4
                            onClick={() => setShowTlsCert((prev) => !prev)}
                            style={{
                              cursor: "pointer",
                              color: "#e7ecf2ff",
                              userSelect: "none",
                            }}
                          >
                            üîê Êü•ÁúãÊúçÂä°Âô®ËØÅ‰π¶‰ø°ÊÅØ {showTlsCert ? "‚ñ≤" : "‚ñº"}
                          </h4>
                          {showTlsCert && (
                            <PeculiarCertificateViewer certificate={liveResult.info["tls ca"]} />
                          )}
                        </div>
                        <a
                          href={`data:text/plain;charset=utf-8,${encodeURIComponent(
                            liveResult.info["tls ca"]
                          )}`}
                          download={`certificate_${testingHost}.crt`}
                          style={{
                            display: "inline-block",
                            marginTop: "1rem",
                            backgroundColor: "#5bc889ff",
                            color: "#fff",
                            padding: "8px 12px",
                            textDecoration: "none",
                            borderRadius: "4px",
                          }}
                        >
                          ‚¨áÔ∏è ‰∏ãËΩΩÊúçÂä°Âô®ËØÅ‰π¶
                        </a>
                      </>
                    )}
                  </>
                ) : (
                  <>
                    <p style={{ color: "red" }}>‚ùå ÊµãËØïÂ§±Ë¥•</p>
                    <p>
                      <strong>ÈîôËØØ‰ø°ÊÅØÔºö</strong>
                      {liveResult.error || liveResult.info?.error?.join(", ") || "Êú™Áü•ÈîôËØØ"}
                    </p>

                  </>
                )}
              </div>
            )}
          </div>
        )}
      </div>
    );
  };


  const renderCertChain = () => {
    if (!Array.isArray(rawCerts) || rawCerts.length === 0) return null;
    return (
      <div style={{ marginTop: "2rem" }}>
        <h3
          onClick={() => setShowCertChain((prev) => !prev)}
          style={{ cursor: "pointer", color: "#8ac6ff", userSelect: "none" }}
        >
          üîê Certificate Chain {showCertChain ? "‚ñ≤" : "‚ñº"}
        </h3>
        {showCertChain && (
          <>
            <div style={{ marginBottom: "10px" }}>
              {rawCerts.map((_, idx) => (
                <button
                  key={idx}
                  onClick={() => setActiveCertIdx(idx)}
                  style={{
                    marginRight: "8px",
                    padding: "4px 10px",
                    backgroundColor: activeCertIdx === idx ? "#007bff" : "#ddd",
                    color: activeCertIdx === idx ? "#fff" : "#000",
                    border: "none",
                    borderRadius: "4px",
                    cursor: "pointer",
                  }}
                >
                  #{idx + 1}
                </button>
              ))}
            </div>
            <PeculiarCertificateViewer certificate={rawCerts[activeCertIdx]} />
          </>
        )}
      </div>
    );
  };

  return (
    <div style={{ backgroundColor: "#111", minHeight: "100vh", padding: "2rem", color: "#fff" }}>
      {/* Âè™Êúâ autodiscover Êàñ autoconfig ÊòæÁ§∫ÈÖçÁΩÆÂùó */}
      {(mech === "autodiscover" || mech === "autoconfig") && (
        <>
          <h2>üìÑ Configuration from Method</h2>
          <p>
            <strong>Requested URI:</strong> {uri}
          </p>

          <pre
            style={{
              background: "#1e1e1e",
              color: "#eee",
              padding: "20px",
              borderRadius: "8px",
              whiteSpace: "pre-wrap",
              maxHeight: "80vh",
              overflowY: "auto",
              border: "1px solid #444",
            }}
          >
            {configContent}
          </pre>

          {configContent && configContent !== "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÖçÁΩÆÂÜÖÂÆπ" && (
            <a
              href={`data:text/xml;charset=utf-8,${encodeURIComponent(configContent)}`}
              download={`config_from_${encodeURIComponent(uri || "unknown")}.xml`}
              style={{
                display: "inline-block",
                marginTop: "1rem",
                backgroundColor: "#3498db",
                color: "#fff",
                padding: "10px 15px",
                textDecoration: "none",
                borderRadius: "4px",
                fontWeight: "bold",
              }}
            >
              ‚¨áÔ∏è Download Configuration
            </a>
          )}
        </>
      )}

      {renderConnectDetailTable()}
      {renderCertChain()}
    </div>
  );

  // return (
  //   <div style={{ backgroundColor: "#111", minHeight: "100vh", padding: "2rem", color: "#fff" }}>
  //     <h2>üìÑ Configuration from Method</h2>
  //     <p>
  //       <strong>Requested URI:</strong> {uri}
  //     </p>

  //     <pre
  //       style={{
  //         background: "#1e1e1e",
  //         color: "#eee",
  //         padding: "20px",
  //         borderRadius: "8px",
  //         whiteSpace: "pre-wrap",
  //         maxHeight: "80vh",
  //         overflowY: "auto",
  //         border: "1px solid #444",
  //       }}
  //     >
  //       {configContent}
  //     </pre>

  //     <a
  //       href={`data:text/plain;charset=utf-8,${encodeURIComponent(configContent)}`}
  //       download={`config_from_${encodeURIComponent(uri || "unknown")}.xml`}
  //       style={{
  //         display: "inline-block",
  //         marginTop: "1rem",
  //         backgroundColor: "#3498db",
  //         color: "#fff",
  //         padding: "10px 15px",
  //         textDecoration: "none",
  //         borderRadius: "4px",
  //       }}
  //     >
  //       ‚¨áÔ∏è Download Configuration
  //     </a>

  //     {renderConnectDetailTable()}
  //     {renderCertChain()}
  //   </div>
  // );
}

export default ConfigViewPage;
